<div class="chat-wrap">

  <!-- No file uploaded -->
  <div class="not-ready" *ngIf="ragStatus() === 'idle'">
    <div class="nr-icon">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/>
      </svg>
    </div>
    <p>Upload a log file first to enable AI querying.</p>
  </div>

  <!-- RAG index building -->
  <div class="not-ready building" *ngIf="ragStatus() === 'building'">
    <div class="build-spinner"></div>
    <div class="build-text">
      <p class="build-title mono">BUILDING AI INDEX</p>
      <p class="build-sub">Embedding error lines into vector store...</p>
      <p class="build-sub">Chat will unlock automatically when ready.</p>
    </div>
  </div>

  <!-- RAG error -->
  <div class="not-ready rag-error" *ngIf="ragStatus() === 'error'">
    <div class="nr-icon red">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
    </div>
    <p>RAG index build failed. Check server logs.</p>
  </div>

  <!-- Ready: messages area -->
  <div class="messages" #messageList *ngIf="ragStatus() === 'ready'">
    <div class="empty-state" *ngIf="messages().length === 0">
      <p class="es-title">ASK ANYTHING ABOUT YOUR LOG</p>
      <div class="suggestions">
        <button class="suggestion" *ngFor="let s of suggestions" (click)="send(s)">{{ s }}</button>
      </div>
    </div>

    <div class="message"
         *ngFor="let m of messages()"
         [class.user-msg]="m.role === 'user'"
         [class.ai-msg]="m.role === 'assistant'">
      <div class="msg-header">
        <span class="msg-role mono">{{ m.role === 'user' ? '> USER' : '# AI' }}</span>
        <span class="msg-time mono">{{ formatTime(m.timestamp) }}</span>
      </div>
      <div class="msg-body">{{ m.text }}</div>
    </div>

    <div class="typing-indicator" *ngIf="isQuerying()">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
  </div>

  <!-- Input -->
  <div class="input-area" *ngIf="ragStatus() === 'ready'">
    <div class="input-wrap">
      <span class="prompt-sym mono">›</span>
      <textarea
        class="chat-input mono"
        rows="1"
        placeholder="ask about your log..."
        [value]="input()"
        (input)="input.set($any($event.target).value)"
        (keydown)="onKeydown($event)"
        [disabled]="isQuerying()"
      ></textarea>
      <button class="send-btn" [disabled]="!input().trim() || isQuerying()" (click)="send()">
        <svg *ngIf="!isQuerying()" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
        <span class="spinner" *ngIf="isQuerying()"></span>
      </button>
    </div>
    <p class="hint mono">Enter to send · Shift+Enter for newline</p>
  </div>

</div>